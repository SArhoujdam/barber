{% extends 'reservations/base.html' %}

{% block title %}Modifier le profil{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-body p-4">
                    <div class="text-center mb-4">
                        <h3 class="fw-bold">Modifier le profil</h3>
                        <p class="text-muted">Mettez à jour vos informations personnelles</p>
                    </div>

                    <!-- Photo de profil actuelle -->
                    <div class="text-center mb-4">
                        <h6>Photo de profil actuelle</h6>
                        {% if profile.profile_image %}
                            <img src="{{ profile.profile_image.url }}" class="rounded-circle" style="width: 100px; height: 100px; object-fit: cover;" alt="Photo de profil">
                        {% else %}
                            <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center" style="width: 100px; height: 100px;">
                                <i class="fas fa-user fa-2x text-white"></i>
                            </div>
                        {% endif %}
                    </div>

                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <!-- Informations personnelles -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="fw-bold text-primary mb-3">Informations personnelles</h5>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.first_name.id_for_label }}" class="form-label">Prénom *</label>
                                {{ form.first_name }}
                                {% if form.first_name.errors %}
                                    <div class="text-danger small">{{ form.first_name.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.last_name.id_for_label }}" class="form-label">Nom *</label>
                                {{ form.last_name }}
                                {% if form.last_name.errors %}
                                    <div class="text-danger small">{{ form.last_name.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.email.id_for_label }}" class="form-label">Email *</label>
                                {{ form.email }}
                                {% if form.email.errors %}
                                    <div class="text-danger small">{{ form.email.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.phone.id_for_label }}" class="form-label">Téléphone *</label>
                                {{ form.phone }}
                                {% if form.phone.errors %}
                                    <div class="text-danger small">{{ form.phone.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Informations spécifiques au barbier -->
                        {% if profile_type == 'barber' %}
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="fw-bold text-primary mb-3">Informations professionnelles</h5>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.speciality.id_for_label }}" class="form-label">Spécialité *</label>
                                {{ form.speciality }}
                                {% if form.speciality.errors %}
                                    <div class="text-danger small">{{ form.speciality.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.experience_years.id_for_label }}" class="form-label">Années d'expérience *</label>
                                {{ form.experience_years }}
                                {% if form.experience_years.errors %}
                                    <div class="text-danger small">{{ form.experience_years.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="col-12 mb-3">
                                <label for="{{ form.bio.id_for_label }}" class="form-label">Biographie</label>
                                {{ form.bio }}
                                {% if form.bio.errors %}
                                    <div class="text-danger small">{{ form.bio.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check">
                                    {{ form.is_available }}
                                    <label class="form-check-label" for="{{ form.is_available.id_for_label }}">
                                        Disponible pour les rendez-vous
                                    </label>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Informations spécifiques au client -->
                        {% if profile_type == 'client' %}
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="fw-bold text-primary mb-3">Informations personnelles</h5>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="{{ form.address.id_for_label }}" class="form-label">Adresse</label>
                                {{ form.address }}
                                {% if form.address.errors %}
                                    <div class="text-danger small">{{ form.address.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.birth_date.id_for_label }}" class="form-label">Date de naissance</label>
                                {{ form.birth_date }}
                                {% if form.birth_date.errors %}
                                    <div class="text-danger small">{{ form.birth_date.errors.0 }}</div>
                                {% endif %}
                            </div>
                            <div class="col-12 mb-3">
                                <label for="{{ form.preferences.id_for_label }}" class="form-label">Préférences</label>
                                {{ form.preferences }}
                                {% if form.preferences.errors %}
                                    <div class="text-danger small">{{ form.preferences.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Photo de profil -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="fw-bold text-primary mb-3">Photo de profil</h5>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="{{ form.profile_image.id_for_label }}" class="form-label">Photo de profil</label>
                                {{ form.profile_image }}
                                {% if form.profile_image.errors %}
                                    <div class="text-danger small">{{ form.profile_image.errors.0 }}</div>
                                {% endif %}
                                <small class="text-muted">Formats acceptés: JPG, PNG, GIF. Taille max: 5MB</small>
                            </div>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Enregistrer les modifications
                            </button>
                            {% if profile_type == 'barber' %}
                            <a href="{% url 'barber_dashboard' %}" class="btn btn-outline-secondary">Annuler</a>
                            {% else %}
                            <a href="{% url 'client_appointments' %}" class="btn btn-outline-secondary">Annuler</a>
                            {% endif %}
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
